<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <title>弥留之国 - Card4j</title>
	<link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="css/theme.css">
	<link rel="stylesheet" href="css/board.css">
	<link rel="stylesheet" href="css/search.css">
	<link rel="stylesheet" href="css/deck-edit.css">
	<script src="js/jquery-3.6.4.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="css/borderland.css">
</head>
<body>
	<header class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
		<div class="container-fluid">
			<a class="navbar-brand fw-semibold" href="index.html">← 返回主页</a>
			<div class="d-flex align-items-center gap-3 ms-auto">
				<span class="text-white-50 small">欢迎回来，
					<strong class="text-white" id="user-display-name"></strong>
				</span>
				<button class="btn btn-outline-light btn-sm" id="logout-btn">退出登录</button>
			</div>
		</div>
	</header>

	<div class="borderland-header">
		<!-- 战斗记录 -->
		<div class="battle-log" id="battle-log">
			<div class="battle-log-header">战斗记录</div>
			<div class="battle-log-content" id="battle-log-content">
				<!-- 战斗记录将在这里显示 -->
			</div>
		</div>
		
		<!-- 规则说明按钮 -->
		<button type="button" class="rules-help-btn" data-bs-toggle="modal" data-bs-target="#borderlandRulesModal">
			?
		</button>
		<div class="container text-center">
			<h1 class="mb-2">
				<i class="bi bi-exclamation-triangle"></i> 弥留之国 <i class="bi bi-exclamation-triangle"></i>
			</h1>
			<p class="lead">生存竞技模式 - 赢者通吃，败者淘汰</p>
		</div>
	</div>

	<main class="container mb-5">
		<!-- 签证状态卡片 -->
		<div class="row mb-4">
			<div class="col-md-8 mx-auto">
				<div class="visa-card" id="visa-card">
					<!-- 未办理签证状态 -->
					<div id="no-visa-state" class="text-center">
						<h3 class="mb-3">未持有签证</h3>
						<p class="mb-4">办理签证可获得40张随机卡组，开启生存之旅</p>
						<div id="punishment-notice" class="punishment-warning d-none">
							<i class="bi bi-clock-history"></i> 
							<span>您处于惩罚期中，剩余时间：<strong id="punishment-time">--</strong></span>
						</div>
					<button class="btn btn-light btn-lg" id="apply-visa-btn" onclick="applyVisa()" disabled>
						<i class="bi bi-passport"></i> 办理签证
					</button>
					</div>
					
					<!-- 持有签证状态 -->
					<div id="has-visa-state" class="d-none">
						<div class="row align-items-center">
							<div class="col-md-4 text-center">
								<div class="visa-status">签证状态</div>
								<div class="days-remaining">
									<span id="days-remaining">10</span>
									<small style="font-size: 1rem;">天</small>
								</div>
							</div>
							<div class="col-md-4 text-center border-start border-end">
								<div class="visa-status">卡组数量</div>
								<div class="days-remaining">
									<span id="deck-count">40</span>
									<small style="font-size: 1rem;">张</small>
								</div>
							</div>
							<div class="col-md-4 text-center">
								<div class="visa-status">不同卡牌</div>
								<div class="days-remaining">
									<span id="unique-cards">0</span>
									<small style="font-size: 1rem;">/54</small>
								</div>
							</div>
						</div>
						<div class="text-center mt-4">
							<button class="btn btn-danger btn-lg me-2" id="match-ai-btn" onclick="startBorderlandAI()">
								<i class="bi bi-robot"></i> 搜寻AI
							</button>
							<button class="btn btn-warning btn-lg me-2" id="match-pvp-btn" onclick="startBorderlandPvP()">
								<i class="bi bi-people-fill"></i> 搜寻玩家
							</button>
							<button class="btn btn-outline-light" onclick="showDeckView()">
								<i class="bi bi-card-list"></i> 查看卡组
							</button>
						</div>
						<!-- 成就提示 -->
						<div id="achievement-notice" class="mt-3 text-center d-none">
							<div class="achievement-badge">
								<i class="bi bi-star-fill"></i> 已达成54张不同卡牌！在你的下一次与玩家玩家的对战获胜后，可携带一张卡离开！
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- 卡组视图 -->
		<div id="deck-view" class="d-none">
			<div class="d-flex justify-content-between align-items-center mb-3">
				<h3>我的卡组</h3>
				<div>
					<span class="badge bg-primary me-2">总计：<span id="total-cards">0</span> 张</span>
					<span class="badge bg-success">不同：<span id="unique-count">0</span> 种</span>
				</div>
			</div>
			<div class="alert alert-warning">
				<i class="bi bi-exclamation-circle"></i> 
				右键点击卡牌可永久丢弃，丢弃后无法恢复！
			</div>
			<div class="card-deck-grid" id="borderland-deck-grid"></div>
		</div>
	</main>

	<!-- 弥留之国规则说明模态框 -->
	<div class="modal fade" id="borderlandRulesModal" tabindex="-1" aria-labelledby="borderlandRulesModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header bg-danger text-white">
					<h5 class="modal-title" id="borderlandRulesModalLabel">
						<i class="bi bi-book me-2"></i>弥留之国规则
					</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<h6 class="text-danger mb-3">🎮 游戏规则</h6>
					<ul class="list-unstyled">
						<li class="mb-2">📋 <strong>签证办理：</strong>首次进入时自动获得40张随机卡组和10天签证</li>
						<li class="mb-2">🎲 <strong>卡组独立：</strong>卡组与你的收藏无关，完全独立系统</li>
						<li class="mb-2">🤖 <strong>搜寻AI：</strong>10秒等待期后与AI对战，击败获得随机1张卡+1天签证</li>
						<li class="mb-2">⚠️ <strong>暴露期：</strong>搜寻AI的10秒等待期间，会被"搜寻玩家"的猎杀者入侵</li>
						<li class="mb-2">🎯 <strong>搜寻玩家：</strong>主动猎杀正在搜寻AI的玩家，立即开始PVP对战</li>
						<li class="mb-2">� <strong>PVP失败：</strong>输给玩家或AI都会失去签证、清空卡组，进入1分钟惩罚期</li>
						<li class="mb-2">� <strong>PVP胜利：</strong>夺取败者全部卡牌和剩余天数</li>
						<li class="mb-2">🎯 <strong>胜利条件：</strong>集齐54张不同的卡牌即可带出选定的卡牌</li>
					</ul>
					<div class="alert alert-warning mt-3">
						<i class="bi bi-exclamation-circle me-2"></i>
						<strong>注意：</strong>这是大逃杀模式！搜寻AI慢慢积累资源，搜寻玩家则猎杀其他玩家！
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
				</div>
			</div>
		</div>
	</div>

	<!-- 带出卡牌选择模态框 -->
	<div class="modal fade export-card-modal" id="export-card-modal" tabindex="-1" data-bs-backdrop="static">
		<div class="modal-dialog modal-xl">
			<div class="modal-content">
				<div class="modal-header bg-success text-white">
					<h5 class="modal-title">
						<i class="bi bi-trophy"></i> 恭喜通关！选择一张卡牌带出弥留之国
					</h5>
				</div>
				<div class="modal-body">
					<div class="alert alert-info">
						<i class="bi bi-info-circle"></i> 
						你已使用54张不同卡牌获得胜利！可以选择其中一张卡牌加入你的收藏。
					</div>
					<div class="card-deck-grid" id="export-card-options"></div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-success btn-lg" id="confirm-export-btn" disabled onclick="confirmExport()">
						确认带出选中的卡牌
					</button>
				</div>
			</div>
		</div>
	</div>

	<script src="js/common/utils.js"></script>
	<script src="js/components/card.js"></script>
	<script src="js/common/auth-interceptor.js"></script>
	<script src="js/components/context-menu.js"></script>
	<script src="js/pages/borderland.js"></script>
</body>
</html>
